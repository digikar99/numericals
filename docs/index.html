<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- CSS only -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
  <!-- JavaScript Bundle with Popper -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa" crossorigin="anonymous"></script>

  <script src="//cdnjs.cloudflare.com/ajax/libs/numeral.js/2.0.6/numeral.min.js"></script>

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>

  <link rel="stylesheet" href="index.css">
  <script src="index.js" type="text/javascript"></script>
  
  <title>numericals | dense-numericals - Performance of NumPy with the convenience of Common Lisp</title>
</head>
<body>
  <h3 class="text-center bg-dark text-white">
    <br/>
    numericals | dense-numericals - Performance of NumPy with the convenience of Common Lisp
    <br/>
    <a class="github-button" href="https://github.com/digikar99/numericals/" aria-label="See numericals on GitHub">Github</a>
    <a href="https://github.com/digikar99/numericals/actions/workflows/CI.yml">
      <img style="padding:0; margin-top:-5px;" src="https://github.com/digikar99/numericals/actions/workflows/CI.yml/badge.svg"/>
    </a>
    <!-- Place this tag where you want the button to render. -->
    <a class="github-button" href="https://github.com/digikar99/numericals/subscription" data-icon="octicon-eye" data-show-count="true" aria-label="Watch digikar99/numericals on GitHub">Watch</a>
    <a class="github-button" href="https://github.com/digikar99/numericals" data-icon="octicon-star" data-show-count="true" aria-label="Star digikar99/numericals on GitHub">Star</a>
    <a class="github-button" href="https://github.com/digikar99/numericals/issues" data-icon="octicon-issue-opened" data-show-count="true" aria-label="Issue digikar99/numericals on GitHub">Issue</a>

    <br/>
  </h3>
  <div class="container">
    <div class="row">
      <div id="carousel" class="carousel slide border border-3 rounded" data-bs-ride="carousel">
        <div class="carousel-indicators">
          <button type="button" data-bs-target="#carousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
          <button type="button" data-bs-target="#carousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
          <button type="button" data-bs-target="#carousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
        <div class="carousel-inner">
          <div class="carousel-item active" onclick="location.href='#benchmark'">
            <div class="d-md-flex flex-row align-items-center w-100">
              <div class="col-md-4 align-middle"><h4 class="text-center">High Performance</h4></div>
              <div id="benchmark-table-div-carousel" class="col-md-8"></div>
            </div>
          </div>
          <div class="carousel-item" onclick="location.href='#optimization'">
            <div class="d-md-flex flex-row align-items-center w-100">
              <div class="col-md-4 align-middle"><h4 class="text-center">Easy to optimize</h4></div>
              <div id="optimization-contents-carousel" class="col-md-8"></div>
            </div>
          </div>
          <div class="carousel-item"
               onclick="location.href='https://github.com/digikar99/dense-arrays/'">
            <div class="d-md-flex flex-row align-items-center w-100">
              <div class="col-md-4 align-middle"><h4 class="text-center">Informative customizable array object</h4></div>
              <div id="nice-print-object-carousel" class="col-md-8"></div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="p-5 w-100 bg-dark text-center"></div>

  <div class="container">
    <div class="row">
      <div class="col-md-6 border border-5">
        <h4 id="tutorial" class="p-3 bg-primary text-white">1. Quick Tutorial</h4>
        <div id="tutorial-contents"></div>
      </div>

      <div class="col-md-6 border border-5">
        <h4 id="api" class="p-3 bg-primary text-white">2. Quick API</h4>
        <div id="api-contents">
          <h5>Configuration Variables:</h5>
          <ul>
            <li>*multithreaded-threshold*</li>
            <li>*default-float-format*</li>
            <li>*inline-with-multithreading*</li>
            <li>*array-element-type* and *array-element-type-alist*</li>
            <li>*array-layout*</li>
            <li>*broadcast-automatically*</li>
          </ul>
          <h5>Simple Utilities</h5>
          <ul>
            <li>asarray</li>
            <li>zeros zeros-like</li>
            <li>ones ones-like</li>
            <li>rand rand-like</li>
            <li>full full-like</li>
            <li>eye</li>
            <li>aref</li>
            <li>astype</li>
            <li>array=</li>
            <li>copy-array transpose concat reshape</li>
          </ul>
          <h5>Arithmetic Operations:</h5>
          <ul>
            <li>+ - * /</li>
            <li>add subtract multiply divide</li>
            <li>two-arg-matmul</li>
          </ul>
          <h5>Comparison Operators:</h5>
          <ul>
            <li>< <= = /= > >=</li>
          </ul>
          <h5>Transcendental Operators:</h5>
          <ul>
            <li>sin asin sinh asinh</li>
            <li>cos acos cosh acosh</li>
            <li>tan atan tanh atanh</li>
            <li>exp expt</li>
            <li>log</li>
          </ul>
          <h5>Rounding Operators:</h5>
          <ul>
            <li>abs ffloor floor fceiling ftruncate</li>
          </ul>
          <h5>Reduction Operators:</h5>
          <ul>
            <li>sum</li>
            <li>vdot</li>
            <li>max</li>
            <li>min</li>
            <li>maximum</li>
            <li>minimum</li>
          </ul>
        </div>
      </div>
      
      <div class="col-md-6 border border-5">
        <h4 id="optimization" class="p-3 bg-primary text-white">3. Optimization Overview</h4>
        <p>Guidelines</p>
        <ul>
          <li>Avoid allocations wherever possible: use in-place operators ending with '!' or equivalently, provide an OUT argument and BROADCAST as NIL</li>
          <li>Declare types and <code>(optimize speed)</code></li>
          <li>Trade off between the use of <code>simple-array</code> and avoiding broadcasts</li>
        </ul>
        <div id="optimization-contents"></div>
      </div>

      <div class="col-md-6 border border-5">
        <h4 id="benchmark" class="p-3 bg-primary text-white">4. Benchmark</h4>
        <form onsubmit="updateBenchmarkTable(); return false">
          <div class="row p-1">
            <label for="library" id="library" class="col-4 offset-1">Library</label>
            <select name="library" class="col-6">
              <option value="dense-numericals">dense-numericals</option>
              <option value="numericals">numericals</option>
            </select>
          </div>
          <div class="row p-1">
            <label for="element-type" id="element-type" class="col-4 offset-1">element-type</label>
            <select name="element-type" class="col-6">
              <option value="single-float">single-float</option>
              <option value="double-float">double-float</option>
            </select>
          </div>
          <div class="row p-1">
            <label for="framework" id="framework" class="col-4 offset-1">Framework</label>
            <select name="framework" class="col-6">
              <option value="all">All</option>
              <option value="numpy" selected="selected">NumPy</option>
              <option value="torch">PyTorch</option>
            </select>
          </div>
          <div class="row p-1">
            <label for="scale" id="scale" class="col-4 offset-1">Array scale</label>
            <select name="scale" class="col-6">
              <option value="all">All</option>
              <option value="10">10</option>
              <option value="100">100</option>
              <option value="10000">10000</option>
              <option value="1000000">1000000</option>
              <option value="100000000">100000000</option>
            </select>
          </div>
          <div class="submit">
            <input type="submit" value="Update">
          </div>
        </form>
        <div id="benchmark-table-div"></div>
        <p>The above numbers indicate how many times is the corresponding lisp function is <em>faster</em> than the corresponding numpy or pytorch function. The numbers were obtained on an Intel i7-8750H running at 3GHz. The lisp code was compiled with (optimize speed) settings for arrays of sizes smaller than 80000. Appropriate type declarations were also used. The dense-numericals code used 6 threads for arrays of sizes larger than 80000, while PyTorch was left at default settings, with torch.get_num_threads() returning a value of 6. Thus, lisp and PyTorch had the benefit of multithreading, while numpy did not.</p>
        <br/>
        <p>SBCL Version: 2.2.6</p>
        <p>Python Version: 3.8.5</p>
        <p>Numpy Version: 1.19.0</p>
        <p>PyTorch Version: 1.7.1.post2</p>
        <br/>
        <p>And while it is true that the lisp code was inlined and compiled wherever appropriate, that is precisely the point. Note that lisp uses incremental compilation and incremental typing, providing you the benefits of dynamicity as default. But in addition, certain compilers like SBCL also bring to you the safety and performance of static typing. The safety and type-guarantees are certainly far from languages like Haskell, but it gets the work done.</p>
        <br/>
        <p>None of the code used (safety 0) declarations; thus in some cases, even higher performance can be attainable at the cost of safety and the potential of running into segmentation faults if types were declared incorrectly.</p>
        <br/>
        
      </div>


     <div class="col-md-12 border border-5">
        <h4 id="goals" class="p-3 bg-primary text-white">5. Goals</h4>
        <div id="goals-contents">
          <div class="col-md-8 offset-md-2">
            
            <p>I think that numericals and dense-numericals as a separate project is justified because of the existence of several unachievable-without-significant-rewrite-or-change-of-goals-or-approach for numcl or magicl. These perhaps exist because of the numericals and dense-numericals and its dependencies depend on CLTL2 API, while numcl and magicl try to stick to ANSI CL. On the other hand, it also seems that Common Lisp without CLTL2 API would be terribly ill-suited for numerical computing. (See <a href="https://gist.github.com/digikar99/ba2f0bb34021bfdc086b9c1c712ca228">here</a> for my wishlist of features for a numerical computing library.)</p>
            <h5>Goals</h5>
            <ol>
              <li>Remain AOT, avoid JAOT. Like SBCL, a combination of <code>(optimize speed)</code> and appropriate type declarations should result in maximal inlining and minimal runtime spent on function calls.</li>
              <li>Inlining should avoid code bloat.</li>
              <li>Like SBCL, provide useful compiler-notes to the user to help them optimize their code.</li>
              <li>Keep the API close to numpy.</li>
              <li>Provide ways to avoid copying arrays.</li>
              <li>The printed representation of the array object should be transparent in terms of its properties method.</li>
              <li>Array broadcasting should be optional, to avoid confusion.</li>
              <li>Cooperate with existing libraries wherever possible.</li>
            </ol>
            
            <h5>Implications of the goals</h5>
            <ul>
              <li>Enable high performance even for arrays as small as size 10. (Goal 1 and 2)</li>
              <li>Need CLTL2, through cl-environments, compiler-notes, and polymorphic-functions. (Goal 1 and 3)</li>
              <li>It is easy to start coding. (Goal 4)</li>
              <li>It is easy to optimize. (Goal 3)</li>
              <li>Needs a custom array class that provides multidimensional strides and offsets. This is provided through abstract-arrays, dense-arrays, and dense-numericals. (Goals 4 and 6)</li>
              <li>Wherever appropriate, functions should have an OUT parameter. (Goal 5)</li>
              <li>Provide inplace operators ending with '!' to avoid explicitly supplying an OUT parameter. For instance, <code>(numericals:sin array :out array :broadcast nil)</code> can be shortened to <code>(numericals:sin! array)</code>. (Goal 5)</li>
              <li>Wherever appropriate, functions should have a BROADCAST parameter that determines whether the arrays should or should not be broadcasted. (Goal 7)</li>
              <li>Arrays created with numcl should "just work". (Goal 8)</li>
              <li>Interoperability with magicl should be easy if not seamless. (Goal 8)</li>
            </ul>          
            <h5>Comparison against numcl and magicl in terms of the (achievability of) goals</h5>
          </div>

          <br/>
          <table class="table table-hover">
            <thead class="table-dark">
              <tr>
                <th scope="col">Goal</th>
                <th scope="col">numericals</th>
                <th scope="col">numcl</th>
                <th scope="col">magicl</th>
                <th scope="col">Description</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <th scope="row" class="text-start">1. Maximal inlining</th>
                <td>&#x2714;</td>
                <td>&#x2714;</td>
                <td>?</td>
                <td class="text-start">needs compiler-macros or polymorphic-functions to dispatch on specialized arrays</td>
              </tr>

              <tr>
                <th scope="row" class="text-start">2. Inlining without code bloat</th>
                <td>&#x2714;</td>
                <td>?</td>
                <td>?</td>
                <td class="text-start">needs separate handling of broadcast and non-broadcasting operations</td>
              </tr>

              <tr>
                <th scope="row" class="text-start">3. Compiler-notes</th>
                <td>&#x2714;</td>
                <td>?</td>
                <td>?</td>
                <td class="text-start">can use compiler-macro-notes, but requires compiler-macros</td>
              </tr>

              <tr>
                <th scope="row" class="text-start">4. Numpy-like API</th>
                <td>&#x2714;</td>
                <td>&#x2714;</td>
                <td>&#xff0b;</td>
                <td>-</td>
              </tr>

              <tr>
                <th scope="row" class="text-start">5. OUT parameter</th>
                <td>&#x2714;</td>
                <td>&#xff0b;</td>
                <td>&#x2714;</td>
                <td>-</td>
              </tr>

              <tr>
                <th scope="row" class="text-start">6. Transparent printed representation</th>
                <td>&#x2714;</td>
                <td>?</td>
                <td>&#x2714;</td>
                <td class="text-start">needs wrapper structures/classes, for example dense-arrays or magicl:tensor</td>
              </tr>

              <tr>
                <th scope="row" class="text-start">7. Optional array broadcasting</th>
                <td>&#x2714;</td>
                <td>&#xff0b;</td>
                <td>?</td>
                <td>-</td>
              </tr>
            </tbody>
          </table>
          <br/>
          <ul class="col-md-6 offset-md-3">
            <li>&#x2714; - available</li>
            <li>? - perhaps unachievable without significant rewrite or change of goals/approach</li>
            <li>&#xff0b; - can be improved, or is doable without much rewrite or change of goals</li>
          </ul>

        </div>
      </div>

    </div>
  </div>

</body>
