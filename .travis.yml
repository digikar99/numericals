language: lisp
sudo: required

env:
  matrix:
    - LISP=sbcl

addons:
  apt:
    packages:
      - sbcl
      - python3-pip

install:
  - sbcl --version
  - python3 -m pip install numpy
  - git clone --branch v2.2.1 https://github.com/digikar99/py4cl2.git # avoid numcl and resulting trivia etc to save test time
  - git clone -b release https://github.com/roswell/roswell.git
  - cd roswell 
  - sh bootstrap
  - ./configure
  - make && sudo make install
  - ros install sbcl-bin
  - cd ~/
  - ls

script:
  - ros -e '(push (uiop:getcwd) ql:*local-project-directories*)
            (ql:quickload :numericals)
            (ql:quickload :numericals/tests)
            (setq 5am:*on-error* nil)
            (setq 5am:*on-failure* nil)' run -- --dynamic-space-size 2048 --eval '(uiop:quit (if (numericals/tests:run-correctness-tests) 0 1))'
    [ $? -eq 1 ]

notifications:
  email: false